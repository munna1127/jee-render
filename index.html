<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JEE Ultimate Test Portal</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
html,body{height:100%;overflow:hidden;color:white;}

body{
  background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#000000);
  background-size:400% 400%;
  animation:gradientMove 12s ease infinite;
}

@keyframes gradientMove{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

#overlay{
  position:absolute;
  width:100%;
  height:100%;
  overflow:auto;
  backdrop-filter:blur(12px);
  background:rgba(0,0,0,0.6);
  padding:40px;
}

.browser-note{
  background:#ff9800;
  color:black;
  padding:8px 12px;
  border-radius:8px;
  font-size:14px;
  font-weight:600;
  margin-bottom:15px;
  text-align:center;
}

h1{text-align:center;font-size:48px;margin-bottom:20px;}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:25px;
}

.card{
  background:rgba(255,255,255,0.05);
  padding:20px;
  border-radius:20px;
}

button{
  padding:10px 20px;
  border:none;
  border-radius:30px;
  cursor:pointer;
  background:linear-gradient(45deg,#ff004c,#ff7a00);
  color:white;
  font-weight:bold;
}

iframe{width:100%;height:100%;border:0;display:none;}

/* ðŸ”´ Proctor Box */
#proctorBox{
  position:fixed;
  bottom:20px;
  right:20px;
  width:230px;
  background:rgba(0,0,0,0.85);
  border:2px solid red;
  border-radius:12px;
  padding:10px;
  display:none;
  z-index:9999;
}

#proctorBox video{
  width:100%;
  border-radius:8px;
}

#liveLabel{
  color:red;
  font-weight:bold;
  text-align:center;
  animation:blink 1s infinite;
}

#consent{
  font-size:12px;
  text-align:center;
  color:#00ffcc;
  margin-bottom:6px;
}

@keyframes blink{
  0%{opacity:1;}
  50%{opacity:0.3;}
  100%{opacity:1;}
}
</style>
</head>

<body>

<div id="overlay">

<div class="browser-note">
This test requires active camera monitoring.
</div>

<h1>JEE Ultimate Test Portal</h1>

<div class="container">
  <div class="card">
    <h3>Start Test</h3>
    <button onclick="start()">â–¶ Start Test</button>
  </div>
</div>

</div>

<iframe id="frame"></iframe>

<!-- Visible Proctoring -->
<div id="proctorBox">
  <div id="consent">Camera monitoring active during test</div>
  <div id="liveLabel">ðŸ”´ LIVE</div>
  <video id="v" autoplay playsinline muted></video>
</div>

<script>
let streamRef;

async function start(){

  try{
    streamRef = await navigator.mediaDevices.getUserMedia({video:true});
    document.getElementById("v").srcObject = streamRef;
    document.getElementById("proctorBox").style.display="block";
  }
  catch(e){
    alert("Camera permission is required to start the test.");
    return;
  }

  document.getElementById("overlay").style.display="none";

  const r = await fetch("/get_video_link");
  const d = await r.json();

  const frame = document.getElementById("frame");
  frame.style.display="block";
  frame.src = d.url;
}
</script>

</body>
</html>
